---
description: Create a deployment guide markdown after code is ready. Documents what to deploy and how.
skills:
  - review-deployment
  - research-knowledge-base
---

# Create Deployment Guide Command

Generate a deployment guide document that tells the user everything they need to deploy the feature/fix to production.

## Usage

```
/create-deployment-guide F007                    # Create guide for feature F007
/create-deployment-guide 009                     # Create guide for bug fix 009
/create-deployment-guide F007 --minimal          # Skip optional sections
```

## When to Run

This command runs **after code is complete and reviewed**:

- After `/resolve-review` completes
- Before or alongside `/verify-local` or `/verify-prod`
- Automatically as part of `/auto-build` (Phase 7)

## Prerequisites

- Code changes are complete and reviewed
- `plan.md` exists with the feature/fix description
- Review findings are resolved (if applicable)

## Process

### 1. Gather Information

Read and analyze:

1. **plan.md** - Understand what was built
2. **build_todos/** - See what steps were implemented
3. **review_todos/** (if exists) - Note any deployment-related findings
4. **Git diff from main** - See all changed files

### 2. Analyze Changes for Deployment Impact

Categorize changes by deployment requirements:

| Change Type         | Deployment Requirement            |
| ------------------- | --------------------------------- |
| New services/jobs   | Deploy service to environment     |
| Database migrations | Run migration command             |
| New models          | Schema changes may need migration |
| Config changes      | May need env var updates          |
| API changes         | May need API redeployment         |
| Dashboard changes   | May need frontend redeployment    |

### 3. Check for Project-Specific Deployment Rules

Search knowledge base for deployment gotchas:

```bash
# Check for deployment-related knowledge
grep -r "deploy" .claude/knowledge/gotchas/
grep -r "migration" .claude/knowledge/
```

Refer to AGENTS.md for project-specific deployment requirements.

### 4. Generate Deployment Guide

Create `deployment-guide.md` in the work item folder using the template below.

## Template: deployment-guide.md

````markdown
# Deployment Guide: {work-item-id}

**Feature/Fix:** {title from plan.md}
**Branch:** {current branch}
**Date Generated:** {YYYY-MM-DD}

---

## Summary

{1-2 sentence summary of what's being deployed}

## Pre-Deployment Checklist

Before deploying, verify:

- [ ] All tests pass locally
- [ ] Type check passes
- [ ] Branch is up to date with main
- [ ] Code review approved (if applicable)
      {additional checks based on change type}

## Deployment Steps

Execute these steps in order:

### Step 1: {First deployment action}

{Description of what to do}

```bash
# Commands to run (if applicable)
```
````

**Expected result:** {What should happen}

### Step 2: {Next action}

{Continue for each deployment step...}

## Post-Deployment Verification

After deployment, verify the feature is working:

### Verify in Production

{Specific checks to perform}

```sql
-- Database verification queries (if applicable)
```

```bash
# CLI commands to verify (if applicable)
```

### Expected Behavior

- {Expected outcome 1}
- {Expected outcome 2}

## Rollback Plan

If issues occur after deployment:

### Can we roll back?

- [ ] Yes - {reason why rollback is safe}
- [ ] Partial - {what can/cannot be rolled back}
- [ ] No - {reason and mitigation}

### Rollback Steps

1. {Step 1}
2. {Step 2}

## Monitoring

### First 24 Hours

| What to Monitor | Where            | Alert Threshold |
| --------------- | ---------------- | --------------- |
| {metric/log}    | {dashboard/tool} | {threshold}     |

### Service Monitoring (if applicable)

- Service name: `{service_name}`
- Expected schedule: {cron or trigger}
- Success criteria: {what indicates success}

## Services Affected

| Service   | Change Required | Notes        |
| --------- | --------------- | ------------ |
| Main app  | {Yes/No}        | {details}    |
| API       | {Yes/No}        | {details}    |
| Dashboard | {Yes/No}        | {details}    |
| Database  | {Yes/No}        | {migration?} |

## Environment Variables (if applicable)

| Variable | Service | Value/Description |
| -------- | ------- | ----------------- |
| {VAR}    | {where} | {description}     |

## Dependencies

- {External dependency 1 (if any)}
- {External dependency 2}

---

**Generated by:** /create-deployment-guide
**Review before deploying** - This guide is auto-generated and should be verified.

````

## Section Guidelines

### What to Include

| Section                  | Always | If Applicable |
| ------------------------ | ------ | ------------- |
| Summary                  | Yes    |               |
| Pre-Deployment Checklist | Yes    |               |
| Deployment Steps         | Yes    |               |
| Post-Deployment Verify   | Yes    |               |
| Rollback Plan            | Yes    |               |
| Monitoring               | Yes    |               |
| Services Affected        |        | Multi-service |
| Environment Variables    |        | New env vars  |
| Dependencies             |        | External deps |

### What NOT to Include

- Implementation details (that's in build_todos)
- Code snippets (unless for verification)
- Historical context (that's in plan.md)

### Minimal Mode (`--minimal`)

Skip these sections:

- Monitoring (if no new services)
- Services Affected (if single service)
- Environment Variables (if none)
- Dependencies (if none)

## Common Deployment Patterns

### Pattern: New Service

```markdown
### Step 1: Deploy service

\`\`\`bash
# Deploy using project's deployment command
\`\`\`

**Expected result:** Service appears in deployment dashboard
````

### Pattern: Database Migration

```markdown
### Step 1: Run database migration

\`\`\`bash

# Run migration command (project-specific)

\`\`\`

**Expected result:** Migration completes without errors

### Pre-Deployment Check

\`\`\`sql
-- Verify current state before migration
SELECT COUNT(\*) FROM {table};
\`\`\`
```

## Output

Creates `deployment-guide.md` in the work item folder containing:

- Complete deployment instructions
- Verification steps with specific queries/commands
- Rollback plan
- Monitoring requirements

## Update plan.md

Add work log entry:

```
| YYYY-MM-DD | create-deployment-guide | Generated deployment guide | {summary of key steps} |
```

## Next Steps

After guide is created, tell the user:

1. Review the deployment guide for accuracy
2. Proceed with `/verify-local` (if needed) or deploy to production
3. Follow the guide during deployment
